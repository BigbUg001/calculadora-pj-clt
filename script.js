const LOGO_BASE64="Calculadora Salarial";let animadores={},ultimoResultadoCLT=null,mainBarChart=null,cltDonutChart=null,pjDonutChart=null,custoEmpresaChart=null,impactoAnualChart=null;function initAnimadores(){const t={duration:1,useEasing:!0,decimal:",",separator:".",prefix:"R$ "},e={"res-variacao-abs":t,"res-clt-liquido":t,"res-pj-liquido":t,"res-clt-anual":t,"res-pj-anual":t,"res-anual-diferenca-valor":{...t,prefix:"+R$ "},"res-clt-salario-em-conta":t};try{for(const t in e){const a=document.getElementById(t);a?(animadores[t]=new countUp.CountUp(a,0,e[t]),animadores[t].error?console.error(`Erro no CountUp para #${t}:`,animadores[t].error):animadores[t].start()):console.warn(`Elemento de animação #${t} não encontrado. O valor será estático.`)}}catch(t){console.error("Erro fatal ao inicializar o CountUp.js.",t)}}const formatadorBRL=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}),SALARIO_MINIMO=1518,TETO_INSS=8157.41,FAIXAS_INSS=[{teto:1518,aliquota:.075,deduzir:0},{teto:2793.88,aliquota:.09,deduzir:22.77},{teto:4190.83,aliquota:.12,deduzir:106.59},{teto:8157.41,aliquota:.14,deduzir:190.42}],INSS_TETO=TETO_INSS*FAIXAS_INSS[3].aliquota-FAIXAS_INSS[3].deduzir,FAIXAS_IRRF=[{limite:2428.8,aliquota:0,deducao:0},{limite:2826.65,aliquota:.075,deducao:182.16},{limite:3751.05,aliquota:.15,deducao:409.71},{limite:4664.68,aliquota:.225,deducao:682.81},{limite:1/0,aliquota:.275,deducao:912.91}],DEDUCAO_DEPENDENTE_IRRF=189.59,DESCONTO_SIMPLIFICADO_IRRF=607.2,ANEXO_III=[{teto:18e4,aliquota:.06,pd:0},{teto:36e4,aliquota:.112,pd:9360},{teto:72e4,aliquota:.135,pd:17640},{teto:18e5,aliquota:.16,pd:35640},{teto:36e5,aliquota:.21,pd:125640},{teto:48e5,aliquota:.33,pd:648e3}],ANEXO_V=[{teto:18e4,aliquota:.155,pd:0},{teto:36e4,aliquota:.18,pd:4500},{teto:72e4,aliquota:.195,pd:9900},{teto:18e5,aliquota:.205,pd:17100},{teto:36e5,aliquota:.23,pd:62100},{teto:48e5,aliquota:.305,pd:54e4}],todosInputIDs=["clt-bruto","clt-dependentes","clt-beneficios","clt-descontos","clt-incluir-provisao","clt-plr-anual","clt-incluir-fgts","pj-faturamento","pj-rbt12","pj-atividade","pj-contabilidade","pj-outros","pj-faturamento-mei","pj-custo-mei","pj-outros-mei","pj-faturamento-manual","pj-taxa-manual","pj-custos-fixos-manual"];function debounce(t,e=300){let a;return function(...o){clearTimeout(a),a=setTimeout((()=>{t.apply(this,o)}),e)}}function criarTaxItem(t,e,a,o="desconto",l="da receita"){const n=document.createElement("div");n.className="tax-item","provento"===o&&n.classList.add("provento");const r=document.createElement("span"),s=document.createElement("span");s.className="percentage",s.textContent=`(${(100*a).toFixed(1)}% ${l})`.replace(".",","),r.append(t,s);const i=document.createElement("strong");return i.textContent=`${"provento"===o?"+":"-"}${formatBRL(e)}`,n.append(r,i),n}function criarTaxItemTotal(t,e,a="desconto"){const o=document.createElement("div");o.className="tax-item tax-item-total","provento"===a&&o.classList.add("provento");const l=document.createElement("span");l.textContent=t;const n=document.createElement("strong");return n.textContent=`${"provento"===a?"+":"-"}${formatBRL(e)}`,o.append(l,n),o}const formatBRL=t=>formatadorBRL.format(t||0),formatPerc=t=>`${t>0?"+":""}${(100*t).toFixed(1)}%`.replace(".",","),getFloat=t=>parseFloat(document.getElementById(t).value)||0,getChecked=t=>document.getElementById(t).checked;let elResVariacaoAbs,elResVariacaoPerc,elVarCard,elResCltLiquido,elResCltSalarioEmConta,elResPjLiquido,elResCltImpostos,elResPjImpostos,elResPjImpostosLabel,elResCltAliquota,elResPjAliquota,elResCltAnual,elResPjAnual,elDifAnualWrapper,elDifAnualLabel,elAnimadorDifAnualValor,elEquivalencia,elTaxDetailsClt,elTaxDetailsPj,elPjDetalheTitulo,elCustoEmpresaTotal,elEconomiaEmpresaTexto,elBtnGerarRelatorio;if("undefined"!=typeof window){const t=debounce(calcularEAtualizarUI,300);document.addEventListener("DOMContentLoaded",(()=>{lerDadosDaURL(),document.body,todosInputIDs.forEach((e=>{const a=document.getElementById(e);if(a){const e="SELECT"===a.tagName||"checkbox"===a.type?"change":"input";"input"===e?a.addEventListener(e,t):a.addEventListener(e,calcularEAtualizarUI)}}));const e=document.querySelectorAll(".pj-tab-btn");e.forEach((t=>{t.addEventListener("click",(t=>{e.forEach((t=>t.classList.remove("active"))),t.currentTarget.classList.add("active");const a=t.currentTarget.dataset.regime;document.querySelectorAll(".pj-regime-group").forEach((t=>{t.style.display=t.id===`pj-${a}-inputs`?"block":"none"})),calcularEAtualizarUI()}))}));const a=document.getElementById("modal-contracheque"),o=document.getElementById("btn-modal-contracheque"),l=document.getElementById("modal-contracheque-close");function n(){a.style.display="none"}o&&o.addEventListener("click",(function(t){t.preventDefault();const e=getFloat("clt-descontos");if(!ultimoResultadoCLT||ultimoResultadoCLT.bruto<=0)return void alert("Por favor, insira um Salário Bruto primeiro.");const o=ultimoResultadoCLT,l=o.inss+o.irrf+e,n=o.inss/(o.bruto||1)*100,r=o.irrf/(o.bruto||1)*100;document.getElementById("modal-salario-bruto").textContent=formatBRL(o.bruto),document.getElementById("modal-total-proventos").textContent=formatBRL(o.bruto),document.getElementById("modal-inss").textContent=formatBRL(o.inss),document.getElementById("modal-irrf").textContent=formatBRL(o.irrf),document.getElementById("modal-outros-descontos").textContent=formatBRL(e),document.getElementById("modal-total-descontos").textContent=formatBRL(l),document.getElementById("modal-inss-aliquota").textContent=n.toFixed(2).replace(".",","),document.getElementById("modal-irrf-aliquota").textContent=r.toFixed(2).replace(".",","),document.getElementById("modal-liquido").textContent=formatBRL(o.salarioEmConta),a.style.display="flex"})),l&&l.addEventListener("click",n),a&&a.addEventListener("click",(t=>{t.target===a&&n()})),document.querySelectorAll(".accordion-button").forEach((t=>{t.addEventListener("click",(()=>{t.classList.toggle("active");const e=t.nextElementSibling;e.style.maxHeight?e.style.maxHeight=null:e.style.maxHeight=e.scrollHeight+"px"}))})),window.atualizarAlturasAccordions=function(){document.querySelectorAll(".accordion-content").forEach((t=>{t.style.maxHeight&&(t.style.maxHeight=t.scrollHeight+"px")}))};const r=document.querySelectorAll(".faq-item");r.forEach((t=>{t.addEventListener("click",(t=>{const e=t.currentTarget.dataset.faq;r.forEach((t=>t.classList.remove("active"))),t.currentTarget.classList.add("active"),document.querySelectorAll(".faq-content-panel").forEach((t=>{t.classList.remove("active"),t.id===`faq-${e}`&&t.classList.add("active")}))}))}));const s=document.getElementById("btn-share-link");s&&s.addEventListener("click",(()=>{const t=gerarQueryString(),e=`${window.location.protocol}//${window.location.host}${window.location.pathname}?${t}`;navigator.share?navigator.share({title:"Simulação Calculadora Salarial: CLT vs PJ",text:"Veja esta simulação que fiz no comparador Calculadora Salarial:",url:e}).catch(console.error):navigator.clipboard.writeText(e).then((()=>{const t=s.innerHTML;s.innerHTML="Link Copiado!",setTimeout((()=>{s.innerHTML=t}),2e3)}),(t=>{alert("Erro ao copiar link.")}))})),elResVariacaoAbs=document.getElementById("res-variacao-abs"),elResVariacaoPerc=document.getElementById("res-variacao-perc"),elVarCard=document.querySelector(".result-card-principal"),elResCltLiquido=document.getElementById("res-clt-liquido"),elResCltSalarioEmConta=document.getElementById("res-clt-salario-em-conta"),elResPjLiquido=document.getElementById("res-pj-liquido"),elResCltImpostos=document.getElementById("res-clt-impostos"),elResPjImpostos=document.getElementById("res-pj-impostos"),elResPjImpostosLabel=document.getElementById("res-pj-impostos-label"),elResCltAliquota=document.getElementById("res-clt-aliquota"),elResPjAliquota=document.getElementById("res-pj-aliquota"),elResCltAnual=document.getElementById("res-clt-anual"),elResPjAnual=document.getElementById("res-pj-anual"),elDifAnualWrapper=document.getElementById("res-anual-diferenca-wrapper"),elDifAnualLabel=document.getElementById("res-anual-diferenca-label"),elAnimadorDifAnualValor=document.getElementById("res-anual-diferenca-valor"),elEquivalencia=document.getElementById("res-equivalencia-texto"),elCustoEmpresaTotal=document.getElementById("custo-empresa-total"),elEconomiaEmpresaTexto=document.getElementById("res-economia-empresa-texto"),elBtnGerarRelatorio=document.getElementById("btn-gerar-relatorio");const i=document.getElementById("modal-negociacao"),c=document.getElementById("modal-negociacao-close"),u=document.getElementById("btn-copiar-relatorio");elTaxDetailsClt=document.getElementById("tax-details-clt"),elTaxDetailsPj=document.getElementById("tax-details-pj"),elPjDetalheTitulo=document.getElementById("pj-detalhe-titulo"),elBtnGerarRelatorio&&elBtnGerarRelatorio.addEventListener("click",(()=>{i&&(i.style.display="flex")})),c&&c.addEventListener("click",(()=>{i.style.display="none"})),u&&u.addEventListener("click",(()=>{const t=document.getElementById("report-text-content");navigator.clipboard&&t&&navigator.clipboard.writeText(t.innerText).then((()=>{alert("Relatório copiado para a área de transferência!")})).catch((t=>{alert("Falha ao copiar. Tente manualmente.")}))})),initAnimadores(),calcularEAtualizarUI()}))}function calcularEAtualizarUI(){try{const t={bruto:getFloat("clt-bruto"),dependentes:getFloat("clt-dependentes"),beneficios:getFloat("clt-beneficios"),descontos:getFloat("clt-descontos"),incluirProvisao:getChecked("clt-incluir-provisao"),plrAnual:getFloat("clt-plr-anual"),incluirFGTS:getChecked("clt-incluir-fgts")},e=document.querySelector(".pj-tab-btn.active")||document.querySelector(".pj-tab-btn"),a=e&&e.dataset?.regime||"simples";let o={regime:a},l=0;"simples"===a?(l=getFloat("pj-faturamento"),o={...o,faturamento:l,rbt12:getFloat("pj-rbt12")||12*l,anexo:"fator_r"===document.getElementById("pj-atividade").value?"v":"iii",contabilidade:getFloat("pj-contabilidade"),outros:getFloat("pj-outros")}):"mei"===a?(l=getFloat("pj-faturamento-mei"),o={...o,faturamento:l,custoDAS:getFloat("pj-custo-mei"),outros:getFloat("pj-outros-mei")}):"manual"===a&&(l=getFloat("pj-faturamento-manual"),o={...o,faturamento:l,taxa:getFloat("pj-taxa-manual"),custosFixos:getFloat("pj-custos-fixos-manual")});const n=t.bruto>0?calcularCLT_Colaborador(t):{valorFinal:0,totalImpostos:0,aliquotaEfetiva:0,detalhesImpostos:[],bruto:0,inss:0,irrf:0,salarioEmConta:0},r=t.bruto>0?calcularCLT_CustoEmpresa(t):{totalCusto:0,bruto:0,inssPatronal:0,fgts:0,provisao13Ferias:0,provisaoMultaFGTS:0,beneficios:0};let s;ultimoResultadoCLT=n,s=l>0?"simples"===a?calcularPJ_Colaborador(o):"mei"===a?calcularPJ_MEI(o):calcularPJ_Manual(o):{valorFinal:0,totalImpostos:0,aliquotaEfetiva:0,titulo:"PJ",detalhesImpostos:[]},atualizarResultados(n,s,t,o,r)}catch(t){console.error("Erro no cálculo:",t)}}function atualizarResultados(t,e,a,o,l){const n=t.valorFinal||0,r=t.salarioEmConta||0,s=e.valorFinal||0,i=t.totalImpostos||0,c=e.totalImpostos||0,u=Math.abs(s-n),d=s>n,m=n>s;atualizarMainBarChart(n,s,d),atualizarDonutCharts({salarioEmConta:t.salarioEmConta,beneficiosProvisoes:Math.max(0,t.valorFinal-t.salarioEmConta),impostosDescontos:t.totalImpostos},{liquido:e.valorFinal,custos:e.totalImpostos});const p=[0],f=[0];for(let t=1;t<=12;t++)p.push(n*t),f.push(s*t);atualizarImpactoAnualChart(p,f);const C=n>0&&s>0?Math.min(n,s):u>0?Math.max(n,s):0,g=C>0?u/C:u>0?1:0,E=document.getElementById("pj-prolabore-calculado"),v=document.getElementById("pj-prolabore-calculado-wrapper");E&&v&&("simples"===o.regime&&e.prolabore>0?(E.value=(e.prolabore||0).toFixed(2).replace(".",","),v.style.display="block"):(E.value="0,00",v.style.display="none"));const I=document.getElementById("pj-strategy-text"),b=document.getElementById("pj-strategy-box");I&&b&&(e.estrategia&&"simples"===o.regime?(I.textContent=e.estrategia,b.style.display="block"):b.style.display="none"),elPjDetalheTitulo&&(elPjDetalheTitulo.textContent=`Detalhes PJ (${e.titulo||"Simples"})`),[".result-card-principal",".result-card-comparativo","#impacto-anual-card","#equivalency-card"].forEach((t=>{document.querySelectorAll(t).forEach((t=>{t.classList.remove("is-updating"),t.offsetWidth,t.classList.add("is-updating")}))})),animadores["res-variacao-abs"]?animadores["res-variacao-abs"].update(u):elResVariacaoAbs&&(elResVariacaoAbs.textContent=formatBRL(u)),elVarCard&&elVarCard.classList.remove("clt-wins"),elResVariacaoPerc&&(elResVariacaoPerc.classList.remove("positivo","negativo","clt-wins"),d?(elResVariacaoPerc.textContent=`${formatPerc(g)} a mais como PJ`,elResVariacaoPerc.classList.add("positivo")):m?(elResVariacaoPerc.textContent=`${formatPerc(g)} a mais como CLT`,elResVariacaoPerc.classList.add("clt-wins"),elVarCard&&elVarCard.classList.add("clt-wins")):elResVariacaoPerc.textContent="Valores equivalentes"),animadores["res-clt-liquido"]?animadores["res-clt-liquido"].update(n):elResCltLiquido&&(elResCltLiquido.textContent=formatBRL(n)),animadores["res-clt-salario-em-conta"]?animadores["res-clt-salario-em-conta"].update(r):elResCltSalarioEmConta&&(elResCltSalarioEmConta.textContent=formatBRL(r)),animadores["res-pj-liquido"]?animadores["res-pj-liquido"].update(s):elResPjLiquido&&(elResPjLiquido.textContent=formatBRL(s)),elResCltImpostos&&(elResCltImpostos.textContent=formatBRL(i)),elResPjImpostos&&(elResPjImpostos.textContent=formatBRL(c)),elResPjImpostosLabel&&(elResPjImpostosLabel.textContent=`Custos (${e.titulo||"PJ"})`),elResCltAliquota&&(elResCltAliquota.textContent=`${(100*t.aliquotaEfetiva).toFixed(1)}% do bruto`.replace(".",",")),elResPjAliquota&&(elResPjAliquota.textContent=`${(100*e.aliquotaEfetiva).toFixed(1)}% da receita`.replace(".",",")),animadores["res-clt-anual"]?animadores["res-clt-anual"].update(12*n):elResCltAnual&&(elResCltAnual.textContent=formatBRL(12*n)),animadores["res-pj-anual"]?animadores["res-pj-anual"].update(12*s):elResPjAnual&&(elResPjAnual.textContent=formatBRL(12*s));const h=Math.abs(12*s-12*n);if(elDifAnualWrapper&&elDifAnualWrapper.classList.remove("positivo","negativo"),animadores["res-anual-diferenca-valor"]&&elDifAnualLabel?d?(animadores["res-anual-diferenca-valor"].options.prefix="+R$ ",animadores["res-anual-diferenca-valor"].update(h),elDifAnualLabel.textContent="/ano (PJ)",elDifAnualWrapper&&elDifAnualWrapper.classList.add("positivo")):m?(animadores["res-anual-diferenca-valor"].options.prefix="+R$ ",animadores["res-anual-diferenca-valor"].update(h),elDifAnualLabel.textContent="/ano (CLT)",elDifAnualWrapper&&elDifAnualWrapper.classList.add("negativo")):(animadores["res-anual-diferenca-valor"].options.prefix="R$ ",animadores["res-anual-diferenca-valor"].update(0),elDifAnualLabel.textContent="Equivalente"):elDifAnualWrapper&&elAnimadorDifAnualValor&&elDifAnualLabel&&(d?(elAnimadorDifAnualValor.textContent=`+${formatBRL(h)}`,elDifAnualLabel.textContent="/ano (PJ)",elDifAnualWrapper.classList.add("positivo")):m?(elAnimadorDifAnualValor.textContent=`+${formatBRL(h)}`,elDifAnualLabel.textContent="/ano (CLT)",elDifAnualWrapper.classList.add("negativo")):(elAnimadorDifAnualValor.textContent=formatBRL(0),elDifAnualLabel.textContent="Equivalente")),elEquivalencia)if(elEquivalencia.textContent="",0===n||0===s)elEquivalencia.textContent="Preencha ambos os cenários (CLT e PJ) para ver a equivalência.";else{const l=document.createElement("span");l.className="equivalencia-valor";const n=document.createElement("strong");if(d){l.textContent=formatBRL(e.valorFinal);const t=calcularEquivalenteCLT(e.valorFinal,a);n.textContent=formatBRL(t),elEquivalencia.append("Para ter o mesmo pacote PJ (",l,"), seu salário bruto CLT precisaria ser de aprox. ",n,".")}else if(m){l.textContent=formatBRL(t.valorFinal);const e=calcularEquivalentePJ(t.valorFinal,o);n.textContent=formatBRL(e),elEquivalencia.append("Para ter o mesmo pacote CLT (",l,"), seu faturamento PJ precisaria ser de aprox. ",n,".")}else elEquivalencia.textContent="Os valores de CLT e PJ já são equivalentes."}if(elTaxDetailsClt){elTaxDetailsClt.textContent="";let e=0,a=0;const o=document.createDocumentFragment(),l=document.createDocumentFragment();if(t.detalhesImpostos.forEach((t=>{"provento"===t.tipo&&t.valor>0?(o.appendChild(criarTaxItem(t.nome,t.valor,t.percentual,"provento","do bruto")),e+=t.valor):"desconto"===t.tipo&&t.valor>0&&(l.appendChild(criarTaxItem(t.nome,t.valor,t.percentual,"desconto","do bruto")),a+=t.valor)})),e>0&&(o.appendChild(criarTaxItemTotal("Total de Benefícios",e,"provento")),elTaxDetailsClt.appendChild(o)),a>0&&(l.appendChild(criarTaxItemTotal("Total de Descontos",a,"desconto")),elTaxDetailsClt.appendChild(l)),0===elTaxDetailsClt.childElementCount){const t=document.createElement("div");t.className="tax-item";const e=document.createElement("span");e.textContent="Nenhum detalhe",t.appendChild(e),elTaxDetailsClt.appendChild(t)}}if(elPjDetalheTitulo&&(elPjDetalheTitulo.textContent=`Detalhes PJ (${e.titulo||"Simples"})`),elTaxDetailsPj){elTaxDetailsPj.textContent="";let t=0;if(e.detalhesImpostos.forEach((e=>{e.valor>0&&(elTaxDetailsPj.appendChild(criarTaxItem(e.nome,e.valor,e.percentual,"desconto","da receita")),t+=e.valor)})),t>0)elTaxDetailsPj.appendChild(criarTaxItemTotal(`Total de Custos ${e.titulo}`,t,"desconto"));else{const t=document.createElement("div");t.className="tax-item";const e=document.createElement("span");e.textContent="Nenhum custo",t.appendChild(e),elTaxDetailsPj.appendChild(t)}}if(atualizarCustoEmpresaChart(l),elCustoEmpresaTotal&&(elCustoEmpresaTotal.textContent=formatBRL(l.totalCusto)),elEconomiaEmpresaTexto&&elBtnGerarRelatorio){const t=l.totalCusto,e=o.faturamento,n=t-e,r=document.getElementById("report-clt-bruto"),s=document.getElementById("report-custo-total"),i=document.getElementById("report-pj-faturamento"),c=document.getElementById("report-economia"),u=document.getElementById("report-texto-negativo"),d=document.getElementById("report-custo-excedente");if(r&&(r.textContent=formatBRL(a.bruto),s.textContent=formatBRL(t),i.textContent=formatBRL(e),c.textContent=formatBRL(Math.abs(n)),d.textContent=formatBRL(Math.abs(n))),t>0&&e>0)if(elEconomiaEmpresaTexto.textContent="",n>0){const t=document.createElement("strong");t.textContent=`${formatBRL(n)} / mês`,elEconomiaEmpresaTexto.append("Sua vantagem (economia para a empresa): ",t),elBtnGerarRelatorio.style.display="flex",u&&(u.style.display="none"),c&&(c.parentElement.style.display="block")}else{const t=document.createElement("strong");t.className="negativo",t.textContent=formatBRL(Math.abs(n)),elEconomiaEmpresaTexto.append("O faturamento PJ é ",t," superior ao custo total do CLT."),elBtnGerarRelatorio.style.display="none",u&&(u.style.display="block"),c&&(c.parentElement.style.display="none")}else elEconomiaEmpresaTexto.textContent="Preencha o salário CLT e o faturamento PJ para ver a economia da empresa.",elBtnGerarRelatorio.style.display="none";atualizarAlturasAccordions()}}function calcularCLT_Colaborador(t){const{bruto:e,dependentes:a,beneficios:o,descontos:l,incluirProvisao:n,plrAnual:r,incluirFGTS:s}=t,i=l,c=calcularINSS_Progressivo(e),u=calcularIRRF_Preciso(e,c,a,i),d=c+u+i,m=e-d,p=(r||0)/12,f=m+o+p,C=n?calcularProvisaoLiquida13(e,a):0,g=n?calcularProvisaoLiquidaFerias(e,c,u,a,i):0,E=.08*e,v=f+(s?E:0)+(C+g),I=[];return o>0&&I.push({nome:"Benefícios (VR, VA, etc)",valor:o,percentual:o/(e||1),tipo:"provento"}),p>0&&I.push({nome:"PLR (Provisão Mensal)",valor:p,percentual:p/(e||1),tipo:"provento"}),s&&E>0&&I.push({nome:"FGTS (Depósito Mensal)",valor:E,percentual:E/(e||1),tipo:"provento"}),n&&C>0&&I.push({nome:"13º (Média Líquida)",valor:C,percentual:C/(e||1),tipo:"provento"}),n&&g>0&&I.push({nome:"Férias + 1/3 (Média Líquida)",valor:g,percentual:g/(e||1),tipo:"provento"}),c>0&&I.push({nome:"INSS",valor:c,percentual:c/(e||1),tipo:"desconto"}),u>0&&I.push({nome:"IRRF",valor:u,percentual:u/(e||1),tipo:"desconto"}),i>0&&I.push({nome:"Outros Descontos",valor:i,percentual:i/(e||1),tipo:"desconto"}),{valorFinal:v,salarioEmConta:m,totalImpostos:d,aliquotaEfetiva:e>0?d/e:0,detalhesImpostos:I,bruto:e,inss:c,irrf:u}}function calcularCLT_CustoEmpresa(t){const{bruto:e,beneficios:a}=t;if(e<=0)return{totalCusto:0,bruto:0,inssPatronal:0,fgts:0,provisao13Ferias:0,provisaoMultaFGTS:0,beneficios:0};const o=.2*e,l=.08*e,n=.194*e,r=.04*e;return{totalCusto:e+o+l+n+r+a,bruto:e,inssPatronal:o,fgts:l,provisao13Ferias:n,provisaoMultaFGTS:r,beneficios:a}}function calcularCustosPJ(t,e,a,o){const l=calcularAliquotaEfetiva(e,o),n=t*l,r=Math.min(.11*a,.11*TETO_INSS),s=calcularIRRF_PelaTabela(a-r,0);return{totalCustos:n+r+s,das:n,inss:r,irrf:s,aliquotaEfetiva:l}}function calcularPJ_Colaborador(t){const{faturamento:e,rbt12:a,anexo:o,contabilidade:l,outros:n}=t;let r,s,i,c,u,d,m;if("iii"===o){r=Math.min(e,Math.max(SALARIO_MINIMO,.01*e)),s="iii";const t=calcularCustosPJ(e,a,r,ANEXO_III);i=t.aliquotaEfetiva,c=t.das,u=t.inss,d=t.irrf,m=`Pró-labore mínimo (R$ ${formatBRL(r)}) para Anexo III Direto.`}else{const t=Math.min(e,Math.max(SALARIO_MINIMO,.28*e)),o=t/(e||1)>=.28?"iii":"v",p=calcularCustosPJ(e,a,t,t/(e||1)>=.28?ANEXO_III:ANEXO_V),f=p.totalCustos+l+n,C=Math.min(e,SALARIO_MINIMO),g=calcularCustosPJ(e,a,C,ANEXO_V);f<g.totalCustos+l+n?(r=t,s=o,i=p.aliquotaEfetiva,c=p.das,u=p.inss,d=p.irrf,m=`Pró-labore de 28% (R$ ${formatBRL(r)}) para otimizar o Fator R e tributar no Anexo III.`):(r=C,s="v",i=g.aliquotaEfetiva,c=g.das,u=g.inss,d=g.irrf,m=`Pró-labore Mínimo (R$ ${formatBRL(r)}) para evitar IRRF alto, aceitando o Anexo V. (Estratégia do "Ponto de Virada")`)}const p=c+u+d+(l+n),f=e-p,C=[];return c>0&&C.push({nome:`Simples (Alíq. Efetiva ${s.toUpperCase()})`,valor:c,percentual:i,tipo:"desconto"}),u>0&&C.push({nome:"INSS Pró-labore",valor:u,percentual:u/(e||1),tipo:"desconto"}),d>0&&C.push({nome:"IRRF Pró-labore",valor:d,percentual:d/(e||1),tipo:"desconto"}),l>0&&C.push({nome:"Contabilidade",valor:l,percentual:l/(e||1),tipo:"desconto"}),n>0&&C.push({nome:"Outros Custos",valor:n,percentual:n/(e||1),tipo:"desconto"}),{valorFinal:Math.max(0,f),totalImpostos:p,titulo:`Simples ${s.toUpperCase()}`,aliquotaEfetiva:e>0?p/e:0,detalhesImpostos:C,prolabore:r,estrategia:m}}function calcularPJ_MEI(t){const{faturamento:e,custoDAS:a,outros:o}=t,l=a+o,n=e-l,r=[];return a>0&&r.push({nome:"DAS-MEI",valor:a,percentual:a/(e||1),tipo:"desconto"}),o>0&&r.push({nome:"Outros Custos",valor:o,percentual:o/(e||1),tipo:"desconto"}),{valorFinal:Math.max(0,n),totalImpostos:l,titulo:"MEI",aliquotaEfetiva:e>0?l/e:0,detalhesImpostos:r,prolabore:0,estrategia:"Não aplicável (Regime MEI)"}}function calcularPJ_Manual(t){const{faturamento:e,taxa:a,custosFixos:o}=t,l=e*(a/100),n=l+o,r=e-n,s=[];return l>0&&s.push({nome:`Imposto Manual (${a}%)`,valor:l,percentual:a/100,tipo:"desconto"}),o>0&&s.push({nome:"Custos Fixos",valor:o,percentual:o/(e||1),tipo:"desconto"}),{valorFinal:Math.max(0,r),totalImpostos:n,titulo:`Manual (${a}%)`,aliquotaEfetiva:e>0?n/e:0,detalhesImpostos:s,prolabore:0,estrategia:"Não aplicável (Cálculo Manual)"}}function calcularProvisaoLiquida13(t,e){if(t<=0)return 0;const a=calcularINSS_Progressivo(t);return(t-a-calcularIRRF_PelaTabela(t-a,e))/12}function calcularProvisaoLiquidaFerias(t,e,a,o,l){if(t<=0)return 0;const n=t+t/3,r=calcularINSS_Progressivo(n);return(n-r-calcularIRRF_Preciso(n,r,o,l)-l)/12}function calcularINSS_Progressivo(t){if(t<=0)return 0;t>TETO_INSS&&(t=TETO_INSS);for(const e of FAIXAS_INSS)if(t<=e.teto)return t*e.aliquota-e.deduzir;return INSS_TETO}function calcularIRRF_Preciso(t,e,a,o){if(t<=0)return 0;const l=calcularIRRF_PelaTabela(t-e-a*DEDUCAO_DEPENDENTE_IRRF-(o||0)),n=calcularIRRF_PelaTabela(t-DESCONTO_SIMPLIFICADO_IRRF);return Math.max(0,Math.min(l,n))}function calcularIRRF_PelaTabela(t,e=0){if(t<=0)return 0;const a=(e||0)*DEDUCAO_DEPENDENTE_IRRF,o=Math.max(0,t-a);for(const t of FAIXAS_IRRF)if(o<=t.limite)return Math.max(0,o*t.aliquota-t.deducao);const l=FAIXAS_IRRF[FAIXAS_IRRF.length-1];return Math.max(0,o*l.aliquota-l.deducao)}function calcularAliquotaEfetiva(t,e){if(t<=0)return 0;let a=e[e.length-1];for(const o of e)if(t<=o.teto){a=o;break}const{aliquota:o,pd:l}=a,n=(t*o-l)/t;return n>0?n:0}function calcularEquivalenteCLT(t,e){if(t<=0)return 0;let a=0,o=3*t,l=0;for(;l<30;){let n=(a+o)/2;const r=calcularCLT_Colaborador({...e,bruto:n,plrAnual:getFloat("clt-plr-anual"),beneficios:getFloat("clt-beneficios"),descontos:getFloat("clt-descontos")}).valorFinal;if(Math.abs(r-t)<=1)return n;r<t?a=n:o=n,l++}return(a+o)/2}function calcularEquivalentePJ(t,e){if(t<=0)return 0;let a=0,o=3*t,l=0;const n=e.regime;for(;l<30;){let r=(a+o)/2,s={...e};"simples"===n?(s.faturamento=r,s.rbt12=Math.max(getFloat("pj-rbt12"),12*r)):("mei"===n||"manual"===n)&&(s.faturamento=r);let i=0;if(i="simples"===n?calcularPJ_Colaborador(s).valorFinal:"mei"===n?calcularPJ_MEI(s).valorFinal:calcularPJ_Manual(s).valorFinal,Math.abs(i-t)<=1)return r;i<t?a=r:o=r,l++}return(a+o)/2}function atualizarMainBarChart(t,e,a){const o=document.getElementById("main-bar-chart");if(!o)return;const l="rgba(0, 212, 200, 0.9)",n={labels:["CLT","PJ"],datasets:[{label:"Valor Líquido Mensal",data:[t,e],backgroundColor:[a?"rgba(152, 195, 121, 0.8)":l,a?l:"rgba(97, 175, 239, 0.8)"],borderRadius:4,borderSkipped:!1}]},r={type:"bar",data:n,options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(t){return` ${t.dataset.label}: ${formatBRL(t.raw)}`}}}},scales:{x:{display:!1,grid:{display:!1}},y:{grid:{display:!1,drawBorder:!1},ticks:{color:"#F0F0F0",font:{size:14,weight:"600",family:"Poppins"}}}}}};mainBarChart?(mainBarChart.data.datasets[0].data=n.datasets[0].data,mainBarChart.data.datasets[0].backgroundColor=n.datasets[0].backgroundColor,mainBarChart.update()):mainBarChart=new Chart(o,r)}function criarOuAtualizarDonut(t,e,a,o,l){const n=document.getElementById(e);if(!n)return null;const r=[],s=[],i=[];o.forEach(((t,e)=>{t>0&&(r.push(t),s.push(a[e]),i.push(l[e]))})),0===r.length&&(r.push(1),s.push("Nenhum dado"),i.push("#3A3052"));const c={labels:s,datasets:[{data:r,backgroundColor:i,borderColor:"rgba(33, 28, 48, 0.5)",borderWidth:2,hoverOffset:4}]},u={type:"doughnut",data:c,options:{responsive:!0,maintainAspectRatio:!0,cutout:"70%",plugins:{legend:{display:!0,position:"bottom",labels:{color:"#A09CB0",font:{family:"Poppins"},padding:10}},tooltip:{callbacks:{label:function(t){const e=t.label||"",a=t.raw||0,o=t.chart.data.datasets[0].data.reduce(((t,e)=>t+e),0),l=o>0?(a/o*100).toFixed(1):0;return"Nenhum dado"===e?"Nenhum dado":` ${e}: ${formatBRL(a)} (${l.replace(".",",")}%)`}}}}}};return t?(t.data=c,t.update(),t):new Chart(n,u)}function atualizarDonutCharts(t,e){cltDonutChart=criarOuAtualizarDonut(cltDonutChart,"clt-donut-chart",["Salário em Conta","Benefícios/Provisões","Impostos/Descontos"],[t.salarioEmConta,t.beneficiosProvisoes,t.impostosDescontos],["#98c379","#61AFEF","#E06C75"]),pjDonutChart=criarOuAtualizarDonut(pjDonutChart,"pj-donut-chart",["Líquido Total","Custos/Impostos"],[e.liquido,e.custos],["#98c379","#E06C75"])}function atualizarCustoEmpresaChart(t){const e=document.getElementById("custo-empresa-chart");if(!e)return;const a=[{label:"Salário Bruto",value:t.bruto},{label:"Benefícios (VA, VR, etc)",value:t.beneficios},{label:"INSS Patronal (20%)",value:t.inssPatronal},{label:"FGTS (8%)",value:t.fgts},{label:"Provisão 13º/Férias (19.4%)",value:t.provisao13Ferias},{label:"Provisão Multa 40% (4%)",value:t.provisaoMultaFGTS}],o=["#4B633C","#6A8A56","#88B273","#A6D990","#C4E6B4","#E2F3DA"],l=a.filter((t=>t.value>0)).sort(((t,e)=>e.value-t.value)),n=[];0===l.length?n.push({label:"Nenhum dado",data:[1],backgroundColor:"#3A3052"}):l.forEach(((t,e)=>{n.push({label:t.label,data:[t.value],backgroundColor:o[e],barThickness:40})}));const r={labels:["Custo Total"],datasets:n},s={type:"bar",data:r,options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(t){const e=t.dataset.label||"",a=t.raw||0;return` ${e}: ${formatBRL(a)}`}}}},scales:{x:{display:!1,stacked:!0,grid:{display:!1},min:0,max:t.totalCusto||1},y:{display:!1,stacked:!0,grid:{display:!1},padding:0}}}};custoEmpresaChart?(custoEmpresaChart.data=r,custoEmpresaChart.options.scales.x.max=t.totalCusto||1,custoEmpresaChart.update()):custoEmpresaChart=new Chart(e,s)}function atualizarImpactoAnualChart(t,e){const a=document.getElementById("impacto-anual-chart");if(!a)return;const o=t[t.length-1]>e[e.length-1],l={type:"line",data:{labels:["M0","M1","M2","M3","M4","M5","M6","M7","M8","M9","M10","M11","M12"],datasets:[{label:"CLT Acumulado",data:t,borderColor:"rgba(152, 195, 121, 1)",borderWidth:o?4:2,pointRadius:0,tension:.1,fill:!0,backgroundColor:"rgba(152, 195, 121, 0.1)"},{label:"PJ Acumulado",data:e,borderColor:"rgba(97, 175, 239, 1)",borderWidth:o?2:4,pointRadius:0,tension:.1,fill:!0,backgroundColor:"rgba(97, 175, 239, 0.1)"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1,callbacks:{title:t=>`Mês ${t[0].dataIndex}`,label:t=>` ${t.dataset.label}: ${formatBRL(t.raw)}`}}},scales:{x:{display:!1},y:{display:!1}}}};impactoAnualChart?(impactoAnualChart.data.datasets[0].data=t,impactoAnualChart.data.datasets[1].data=e,impactoAnualChart.data.datasets[0].borderWidth=o?4:2,impactoAnualChart.data.datasets[1].borderWidth=o?2:4,impactoAnualChart.update("none")):impactoAnualChart=new Chart(a,l)}function addPdfHeader(t){const e=t.internal.pageSize.getWidth();t.setFillColor("#211C30"),t.rect(0,0,e,15,"F");try{t.setFont("Poppins","bold"),t.setFontSize(16),t.setTextColor("#F0F0F0"),t.text("Calculex",10,11.5)}catch(e){console.error("Erro ao adicionar logo:",e),t.setFont("Poppins","bold"),t.setFontSize(16),t.setTextColor("#F0F0F0"),t.text("Calculex",10,11.5)}return 15}function gerarQueryString(){const t=new URLSearchParams,e=document.querySelector(".pj-tab-btn.active").dataset.regime;return t.set("regime",e),t.set("clt_bruto",getFloat("clt-bruto")),t.set("clt_dep",getFloat("clt-dependentes")),t.set("clt_ben",getFloat("clt-beneficios")),t.set("clt_desc",getFloat("clt-descontos")),t.set("clt_plr",getFloat("clt-plr-anual")),t.set("clt_prov",getChecked("clt-incluir-provisao")?"1":"0"),t.set("clt_fgts",getChecked("clt-incluir-fgts")?"1":"0"),t.set("pj_fat_s",getFloat("pj-faturamento")),t.set("pj_rbt12",getFloat("pj-rbt12")),t.set("pj_ativ",document.getElementById("pj-atividade").value),t.set("pj_cont",getFloat("pj-contabilidade")),t.set("pj_outros_s",getFloat("pj-outros")),t.set("pj_fat_mei",getFloat("pj-faturamento-mei")),t.set("pj_das",getFloat("pj-custo-mei")),t.set("pj_outros_mei",getFloat("pj-outros-mei")),t.set("pj_fat_m",getFloat("pj-faturamento-manual")),t.set("pj_taxa_m",getFloat("pj-taxa-manual")),t.set("pj_custos_m",getFloat("pj-custos-fixos-manual")),t.toString()}function lerDadosDaURL(){const t=new URLSearchParams(window.location.search);if(0!==t.size)try{const e=t.get("regime");e&&(document.querySelectorAll(".pj-tab-btn").forEach((t=>{const a=t.dataset.regime===e;t.classList.toggle("active",a)})),document.querySelectorAll(".pj-regime-group").forEach((t=>{t.style.display=t.id===`pj-${e}-inputs`?"block":"none"}))),document.getElementById("clt-bruto").value=t.get("clt_bruto")||"",document.getElementById("clt-dependentes").value=t.get("clt_dep")||"0",document.getElementById("clt-beneficios").value=t.get("clt_ben")||"",document.getElementById("clt-descontos").value=t.get("clt_desc")||"",document.getElementById("clt-plr-anual").value=t.get("clt_plr")||"",document.getElementById("clt-incluir-provisao").checked="1"===t.get("clt_prov"),document.getElementById("clt-incluir-fgts").checked="1"===t.get("clt_fgts"),document.getElementById("pj-faturamento").value=t.get("pj_fat_s")||"",document.getElementById("pj-rbt12").value=t.get("pj_rbt12")||"",document.getElementById("pj-atividade").value=t.get("pj_ativ")||"fator_r",document.getElementById("pj-contabilidade").value=t.get("pj_cont")||"",document.getElementById("pj-outros").value=t.get("pj_outros_s")||"",document.getElementById("pj-faturamento-mei").value=t.get("pj_fat_mei")||"",document.getElementById("pj-custo-mei").value=t.get("pj_das")||"",document.getElementById("pj-outros-mei").value=t.get("pj_outros_mei")||"",document.getElementById("pj-faturamento-manual").value=t.get("pj_fat_m")||"",document.getElementById("pj-taxa-manual").value=t.get("pj_taxa_m")||"",document.getElementById("pj-custos-fixos-manual").value=t.get("pj_custos_m")||"",calcularEAtualizarUI()}catch(t){console.error("Erro ao ler dados da URL:",t)}}"undefined"!=typeof module&&module.exports&&(module.exports={calcularCLT_Colaborador:calcularCLT_Colaborador,calcularPJ_Colaborador:calcularPJ_Colaborador,calcularPJ_MEI:calcularPJ_MEI,calcularPJ_Manual:calcularPJ_Manual,calcularINSS_Progressivo:calcularINSS_Progressivo,calcularIRRF_Preciso:calcularIRRF_Preciso,calcularIRRF_PelaTabela:calcularIRRF_PelaTabela,calcularAliquotaEfetiva:calcularAliquotaEfetiva,SALARIO_MINIMO:SALARIO_MINIMO,TETO_INSS:TETO_INSS,FAIXAS_INSS:FAIXAS_INSS,FAIXAS_IRRF:FAIXAS_IRRF,ANEXO_III:ANEXO_III,ANEXO_V:ANEXO_V});