let animadores={};function initAnimadores(){const a={duration:.8,useEasing:!0,decimal:",",separator:".",suffix:"%"};try{if("undefined"==typeof countUp)return void console.error("ERRO CRÍTICO: Biblioteca CountUp.js não carregou a tempo!");const o=document.getElementById("res-fator-r-perc");o?(animadores.fatorR=new countUp.CountUp(o,0,a),animadores.fatorR.error?console.error("Erro ao criar animador:",animadores.fatorR.error):animadores.fatorR.start()):console.warn("Elemento res-fator-r-perc não encontrado.")}catch(a){console.error("Erro fatal no initAnimadores:",a)}}function calcularFatorR(){const a=getFloat("faturamento-bruto"),o=getFloat("gastos-folha");if(a<=0||o<=0)return{fatorR:0,anexo:"Preencha os dados",aliquota:"Alíquota inicial a partir de...",explicacao:"Insira seu faturamento bruto e seus gastos com folha (pró-labore) para calcular seu Fator R.",classe:""};const e=o/a;let r,t,n,i;return e>=.28?(r="Anexo III",t="A partir de 6%",n=`Parabéns! Seu Fator R de ${(100*e).toFixed(1)}% é igual ou superior a 28%, enquadrando sua empresa no Anexo III. Sua alíquota inicial é de 6%.`,i="positivo"):(r="Anexo V",t="A partir de 15,5%",n=`Atenção! Seu Fator R de ${(100*e).toFixed(1)}% é inferior a 28%, enquadrando sua empresa no Anexo V. Sua alíquota inicial é de 15,5%. Considere aumentar seu pró-labore para R$ ${formatBRL(.28*a)} para economizar.`,i="negativo"),{fatorR:e,anexo:r,aliquota:t,explicacao:n,classe:i}}function atualizarUI(){try{const a=calcularFatorR(),o=document.getElementById("res-card-principal"),e=document.getElementById("res-anexo-nome"),r=document.getElementById("res-anexo-aliquota"),t=document.getElementById("res-explicacao");animadores.fatorR&&animadores.fatorR.update(100*a.fatorR),e.textContent=a.anexo,r.textContent=a.aliquota,t.innerHTML=a.explicacao,o.classList.remove("positivo","negativo"),a.classe&&o.classList.add(a.classe)}catch(a){console.error("Erro DENTRO de atualizarUI:",a)}}if("undefined"!=typeof window){const a=debounce(atualizarUI,300);document.addEventListener("DOMContentLoaded",(()=>{["faturamento-bruto","gastos-folha"].forEach((o=>{const e=document.getElementById(o);e&&e.addEventListener("input",a)}))})),window.addEventListener("load",(()=>{try{initAnimadores(),atualizarUI()}catch(a){console.error("Erro durante o window.onload:",a)}}))}