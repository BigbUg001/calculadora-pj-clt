let animadores={},rescisaoDonutChart=null;function initAnimadores(){const o={duration:.8,useEasing:!0,decimal:",",separator:".",prefix:"R$ "},e={"res-total-rescisao":o,"res-total-proventos":{...o,prefix:"+R$ "},"res-total-descontos":{...o,prefix:"-R$ "},"res-total-direitos":o};try{if("undefined"==typeof countUp)return void console.error("ERRO CRÍTICO: Biblioteca CountUp.js não carregou a tempo!");for(const o in e){const a=document.getElementById(o);a?(animadores[o]=new countUp.CountUp(a,0,e[o]),animadores[o].error?console.error(`Erro ao criar animador para #${o}:`,animadores[o].error):animadores[o].start()):console.warn(`Elemento #${o} não encontrado.`)}}catch(o){console.error("Erro fatal no initAnimadores:",o)}}const TETO_SEGURO=2313.74,FAIXAS_SEGURO=[{teto:1968.36,aliquota:.8,parcela:0},{teto:3280.93,aliquota:.5,parcela:1574.69},{teto:1/0,aliquota:0,parcela:2313.74}];function calcularRescisao(){const o=getFloat("salario-bruto"),e=getString("tipo-rescisao"),a=getString("aviso-previo"),t=getString("data-admissao"),r=getString("data-demissao");let s=getFloat("saldo-fgts");const i=getFloat("num-ferias-vencidas");let n=getFloat("media-salarios");const l=getFloat("num-solicitacao-seguro"),d=getFloat("n-dependentes");n<=0&&o>0&&(n=o);let c={saldoSalario:0,avisoPrevio:0,decimoTerceiro:0,totalFerias:0},u={inss:0,irrf:0,avisoPrevio:0},p=[],m={multa:0,saqueTotal:0},v={direito:!1,parcelas:0,valorParcela:0,texto:""};const h={liquidoFinal:0,brutoTotal:0,descontosTotal:0,detalhes:[],brutoDetalhado:{},direitosFGTS:{},mesesDeTrabalho:0,seguro:v};if(!o||!t||!r)return h;const g=new Date(t+"T00:00:00"),S=new Date(r+"T00:00:00");if(isNaN(g.getTime())||isNaN(S.getTime()))return{...h,detalhes:[{nome:"Erro: Verifique as datas",valor:0,tipo:"info"}]};if(S<g)return{...h,detalhes:[{nome:"Erro: Demissão antes da admissão",valor:0,tipo:"info"}]};let f=S.getFullYear()-g.getFullYear(),T=S.getMonth()-g.getMonth(),F=S.getDate()-g.getDate();F<0&&(T--,F+=new Date(S.getFullYear(),S.getMonth(),0).getDate()),T<0&&(f--,T+=12);const E=12*f+T+(F>=15?1:0),b=S.getDate(),A=S.getMonth()+1;let y=s>0?s:.08*o*E;if(c.saldoSalario=o/30*b,"justa_causa"!==e){c.decimoTerceiro=o/12*A;const e=i*o,a=e/3;let t=E%12;E>0&&0===t&&i<f&&(t=12);const r=o/12*t,s=r/3;c.totalFerias=e+a+r+s}else c.totalFerias=i*o+i*o/3;const I=.08*c.saldoSalario,D=.08*c.decimoTerceiro,R=y+I+D;if("sem_justa_causa"===e){if("indenizado"===a){const e=Math.min(90,30+3*Math.max(0,f));c.avisoPrevio=o/30*e}m.multa=.4*R,m.saqueTotal=y+m.multa+I+D,p.push({nome:"Multa 40% FGTS (pago pela empresa)",valor:m.multa,tipo:"info"}),p.push({nome:"Direito a Saque FGTS (Saldo + Multa + Verbas)",valor:m.saqueTotal,tipo:"info"}),v=calcularSeguroDesemprego(E,n,l)}else if("pedido_demissao"===e)"dispensado"===a&&(u.avisoPrevio=o),p.push({nome:"Não tem direito a Saque FGTS",valor:0,tipo:"info"}),p.push({nome:"Não tem direito a Multa FGTS",valor:0,tipo:"info"}),v.texto="<strong>Não tem direito.</strong> O Seguro-Desemprego não é pago em casos de pedido de demissão.";else if("justa_causa"===e)p.push({nome:"Não tem direito a Aviso Prévio",valor:0,tipo:"info"}),p.push({nome:"Não tem direito a 13º Proporcional",valor:0,tipo:"info"}),p.push({nome:"Não tem direito a Férias Proporcionais",valor:0,tipo:"info"}),p.push({nome:"Não tem direito a Saque/Multa FGTS",valor:0,tipo:"info"}),v.texto="<strong>Não tem direito.</strong> A demissão por justa causa não dá direito ao Seguro-Desemprego.";else if("acordo_mutuo"===e){if("indenizado"===a){const e=Math.min(90,30+3*Math.max(0,f));c.avisoPrevio=o/30*e/2}m.multa=.2*R,m.saqueTotal=.8*y+m.multa+I+D,p.push({nome:"Multa 20% FGTS (Acordo)",valor:m.multa,tipo:"info"}),p.push({nome:"Direito a Saque FGTS (80% do saldo + Verbas)",valor:m.saqueTotal,tipo:"info"}),v.texto="<strong>Não tem direito.</strong> A modalidade de Acordo Mútuo não dá direito ao Seguro-Desemprego."}const x=calcularINSS_Progressivo(c.saldoSalario),P=calcularINSS_Progressivo(c.decimoTerceiro);u.inss=x+P;const C=c.saldoSalario-x,N=c.decimoTerceiro-P,q=c.totalFerias,_=calcularIRRF_PelaTabela(C,d),G=calcularIRRF_PelaTabela(N,d),M=calcularIRRF_PelaTabela(q,d);u.irrf=_+G+M;const O=c.saldoSalario+c.avisoPrevio+c.decimoTerceiro+c.totalFerias,L=u.inss+u.irrf+u.avisoPrevio,U=O-L,z=[];return c.saldoSalario>0&&z.push({nome:`Saldo de Salário (${b} dias)`,valor:c.saldoSalario,tipo:"provento"}),c.avisoPrevio>0&&z.push({nome:"Aviso Prévio Indenizado",valor:c.avisoPrevio,tipo:"provento"}),c.decimoTerceiro>0&&z.push({nome:`13º Proporcional (${A}/12 avos)`,valor:c.decimoTerceiro,tipo:"provento"}),c.totalFerias>0&&z.push({nome:"Total Férias (Vencidas + Prop. + 1/3)",valor:c.totalFerias,tipo:"provento"}),x>0&&z.push({nome:"INSS (sobre Saldo de Salário)",valor:x,tipo:"desconto"}),P>0&&z.push({nome:"INSS (sobre 13º)",valor:P,tipo:"desconto"}),_>0&&z.push({nome:"IRRF (sobre Saldo de Salário)",valor:_,tipo:"desconto"}),G>0&&z.push({nome:"IRRF (sobre 13º)",valor:G,tipo:"desconto"}),M>0&&z.push({nome:"IRRF (sobre Férias)",valor:M,tipo:"desconto"}),u.avisoPrevio>0&&z.push({nome:"Aviso Prévio (não cumprido)",valor:u.avisoPrevio,tipo:"desconto"}),p.forEach((o=>z.push(o))),{liquidoFinal:U,brutoTotal:O,descontosTotal:L,detalhes:z,brutoDetalhado:c,direitosFGTS:{saldo:y,multa:m.multa,saqueTotal:m.saqueTotal},mesesDeTrabalho:E,seguro:v}}function atualizarUI(){try{const o=calcularRescisao(),e=getString("tipo-rescisao"),a=isNaN(o.liquidoFinal)?0:o.liquidoFinal,t=isNaN(o.brutoTotal)?0:o.brutoTotal,r=isNaN(o.descontosTotal)?0:o.descontosTotal,s=a+(isNaN(o.direitosFGTS.saqueTotal)?0:o.direitosFGTS.saqueTotal);animadores["res-total-rescisao"]&&animadores["res-total-rescisao"].update(a),animadores["res-total-proventos"]&&animadores["res-total-proventos"].update(t),animadores["res-total-descontos"]&&animadores["res-total-descontos"].update(r),animadores["res-total-direitos"]&&animadores["res-total-direitos"].update(s),atualizarRescisaoDonutChart(o.brutoDetalhado,o.direitosFGTS,o.seguro.direito,e);const i=document.getElementById("tax-details-rescisao");if(i){i.textContent="";let e=0,a=0;const t=document.createDocumentFragment(),r=document.createDocumentFragment(),s=document.createDocumentFragment();(o.detalhes||[]).forEach((o=>{if(o&&(0!==o.valor||"info"===o.tipo&&!o.nome.includes("Seguro")))if("provento"===o.tipo)t.appendChild(criarTaxItem(o.nome,o.valor,"provento")),e+=o.valor;else if("desconto"===o.tipo)r.appendChild(criarTaxItem(o.nome,o.valor,"desconto")),a+=o.valor;else if("info"===o.tipo){const e=criarTaxItem(o.nome,o.valor,"provento");e.style.color="var(--cor-texto-secundario)",e.querySelector("strong")&&(e.querySelector("strong").style.color="var(--cor-texto-secundario)",e.querySelector("strong").textContent=o.valor>0?formatBRL(o.valor):"Não"),s.appendChild(e)}})),e>0&&(t.appendChild(criarTaxItemTotal("Total de Verbas",e,"provento")),i.appendChild(t)),a>0&&(r.appendChild(criarTaxItemTotal("Total de Descontos",a,"desconto")),i.appendChild(r)),s.childElementCount>0&&i.appendChild(s),0===i.childElementCount&&(o.detalhes&&o.detalhes.length>0&&o.detalhes[0].nome.startsWith("Erro:")?i.innerHTML=`<div class="tax-item"><span style="color: var(--cor-negativo);">${o.detalhes[0].nome}</span></div>`:i.innerHTML='<div class="tax-item"><span>Preencha os dados</span></div>')}const n=document.getElementById("seguro-desemprego-card"),l=document.getElementById("seguro-desemprego-texto");n&&l&&(0===t&&0===r&&0===a?n.style.display="none":(n.style.display="block",l.innerHTML=o.seguro.texto)),atualizarAlturasAccordions()}catch(o){console.error("Erro DENTRO de atualizarUI:",o)}}function atualizarRescisaoDonutChart(o,e,a,t){const r=document.getElementById("rescisao-chart-container");if(!r)return;rescisaoDonutChart&&rescisaoDonutChart.destroy(),r.innerHTML="";const s=document.createElement("canvas");s.id="rescisao-donut-chart",r.appendChild(s);const i=s,{saldoSalario:n,avisoPrevio:l,decimoTerceiro:d,totalFerias:c}=o,{multa:u,saqueTotal:p}=e,m=p-u,v=[],h=[],g=[];n>0&&(v.push("Saldo de Salário"),h.push(n),g.push("#1976D2")),l>0&&(v.push("Aviso Prévio"),h.push(l),g.push("#0D47A1")),d>0&&(v.push("13º Salário"),h.push(d),g.push("#F57C00")),c>0&&(v.push("Férias (Total)"),h.push(c),g.push("#FB8C00")),"sem_justa_causa"!==t&&"acordo_mutuo"!==t||(u>0&&(v.push("Multa FGTS"),h.push(u),g.push("#D32F2F")),m>0&&(v.push("Saque Saldo FGTS"),h.push(m),g.push("#c678dd"))),a&&(v.push("Seguro-Desemprego"),h.push(.1),g.push("#42A5F5")),0===h.length&&(v.push("Nenhum provento"),h.push(1),g.push("#3A3052")),rescisaoDonutChart=new Chart(i,{type:"doughnut",data:{labels:v,datasets:[{data:h,backgroundColor:g,borderColor:"rgba(255,255,255,0)",borderWidth:0,hoverOffset:4}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"70%",plugins:{legend:{display:!0,position:"bottom",labels:{color:"#A09CB0",font:{family:"Poppins"},padding:10,filter:function(o,e){return"Seguro-Desemprego"!==o.text}}},tooltip:{callbacks:{label:function(o){const e=o.label||"",a=o.raw||0;if("Seguro-Desemprego"===e)return" Seguro-Desemprego (Ver card)";const t=o.chart.data.datasets[0].data.reduce(((o,e)=>o+e),0),r=t>0?(a/t*100).toFixed(1):0;return` ${e}: ${formatBRL(a)} (${r.replace(".",",")}%)`}}}}}})}function atualizarAlturasAccordions(){document.querySelectorAll(".accordion-content").forEach((o=>{const e=o.previousElementSibling;e&&e.classList.contains("active")&&(o.style.maxHeight=o.scrollHeight+"px")}))}function atualizarOpcoesAvisoPrevio(){const o=getString("tipo-rescisao"),e=document.getElementById("aviso-previo"),a=document.getElementById("aviso-previo-group");if(!e||!a)return;const t=Array.from(e.options),r={sem_justa_causa:["indenizado","trabalhado"],pedido_demissao:["trabalhado","dispensado"],acordo_mutuo:["indenizado","trabalhado"],justa_causa:[]}[o]||[];if(0===r.length)return void(a.style.display="none");a.style.display="block";let s=null;t.forEach((o=>{r.includes(o.value)?(o.style.display="block",s||(s=o.value)):o.style.display="none"})),r.includes(e.value)||(e.value=s)}function calcularSeguroDesemprego(o,e,a){let t=0,r=!1,s="";if(1===a?o>=24?t=5:o>=12&&(t=4):2===a?o>=24?t=5:o>=12?t=4:o>=9&&(t=3):o>=24?t=5:o>=12?t=4:o>=6&&(t=3),0===t)return s=`<strong>Não tem direito.</strong> Para a ${a}ª solicitação, você precisaria de mais tempo de trabalho (mínimo de ${[0,12,9,6][a]} meses). Você trabalhou ${o} meses.`,{direito:r,parcelas:t,valorParcela:0,texto:s};let i=0;return i=e<=FAIXAS_SEGURO[0].teto?e*FAIXAS_SEGURO[0].aliquota:e<=FAIXAS_SEGURO[1].teto?(e-FAIXAS_SEGURO[0].teto)*FAIXAS_SEGURO[1].aliquota+FAIXAS_SEGURO[1].parcela:FAIXAS_SEGURO[2].parcela,i=Math.max(i,SALARIO_MINIMO),r=!0,s=`<strong>Direito provável a ${t} parcelas de ${formatBRL(i)}.</strong> (Total: ${formatBRL(t*i)}).`,{direito:r,parcelas:t,valorParcela:i,texto:s}}if("undefined"!=typeof window){const o=debounce(atualizarUI,300),e=atualizarUI;document.addEventListener("DOMContentLoaded",(()=>{["tipo-rescisao","salario-bruto","data-admissao","data-demissao","aviso-previo","saldo-fgts","num-ferias-vencidas","media-salarios","num-solicitacao-seguro","n-dependentes"].forEach((a=>{const t=document.getElementById(a);if(t){const a="SELECT"===t.tagName||"date"===t.type?"change":"input";"input"===a?t.addEventListener(a,o):t.addEventListener("change",e),"tipo-rescisao"===a&&t.addEventListener("change",atualizarOpcoesAvisoPrevio)}})),document.querySelectorAll(".accordion-button").forEach((o=>{o.addEventListener("click",(()=>{o.classList.toggle("active");const e=o.nextElementSibling;e.style.maxHeight?e.style.maxHeight=null:e.style.maxHeight=e.scrollHeight+"px"}))})),atualizarOpcoesAvisoPrevio()})),window.addEventListener("load",(()=>{try{initAnimadores(),atualizarUI()}catch(o){console.error("Erro durante o window.onload:",o)}}))}