let animadores={},ultimoResultadoCLT=null,cltDonutChart=null;function initAnimadores(){const t={duration:1,useEasing:!0,decimal:",",separator:".",prefix:"R$ "},e={"res-clt-pacote":t,"res-clt-salario-em-conta":t};try{for(const t in e){const o=document.getElementById(t);o?(animadores[t]=new countUp.CountUp(o,0,e[t]),animadores[t].error?console.error(`Erro no CountUp para #${t}:`,animadores[t].error):animadores[t].start()):console.warn(`Elemento de animação #${t} não encontrado. O valor será estático.`)}}catch(t){console.error("Erro fatal ao inicializar o CountUp.js.",t)}}const todosInputIDs=["clt-bruto","clt-dependentes","clt-beneficios","clt-descontos","clt-incluir-provisao","clt-plr-anual","clt-incluir-fgts"];let elResCltPacote,elResCltSalarioEmConta,elResCltImpostos,elResCltAliquota,elTaxDetailsClt;if("undefined"!=typeof window){const t=debounce(calcularEAtualizarUI,300);document.addEventListener("DOMContentLoaded",(()=>{todosInputIDs.forEach((e=>{const o=document.getElementById(e);if(o){const e="SELECT"===o.tagName||"checkbox"===o.type?"change":"input";"input"===e?o.addEventListener(e,t):o.addEventListener(e,calcularEAtualizarUI)}}));const e=document.getElementById("modal-contracheque"),o=document.getElementById("btn-modal-contracheque"),a=document.getElementById("modal-contracheque-close");function l(){e.style.display="none"}o&&o.addEventListener("click",(function(t){t.preventDefault();const o=getFloat("clt-descontos");if(!ultimoResultadoCLT||ultimoResultadoCLT.bruto<=0)return void alert("Por favor, insira um Salário Bruto primeiro.");const a=ultimoResultadoCLT,l=a.inss+a.irrf+o,n=a.inss/(a.bruto||1)*100,r=a.irrf/(a.bruto||1)*100;document.getElementById("modal-salario-bruto").textContent=formatBRL(a.bruto),document.getElementById("modal-total-proventos").textContent=formatBRL(a.bruto),document.getElementById("modal-inss").textContent=formatBRL(a.inss),document.getElementById("modal-irrf").textContent=formatBRL(a.irrf),document.getElementById("modal-outros-descontos").textContent=formatBRL(o),document.getElementById("modal-total-descontos").textContent=formatBRL(l),document.getElementById("modal-inss-aliquota").textContent=n.toFixed(2).replace(".",","),document.getElementById("modal-irrf-aliquota").textContent=r.toFixed(2).replace(".",","),document.getElementById("modal-liquido").textContent=formatBRL(a.salarioEmConta),e.style.display="flex"})),a&&a.addEventListener("click",l),e&&e.addEventListener("click",(t=>{t.target===e&&l()})),document.querySelectorAll(".accordion-button").forEach((t=>{t.addEventListener("click",(()=>{t.classList.toggle("active");const e=t.nextElementSibling;e.style.maxHeight?e.style.maxHeight=null:e.style.maxHeight=e.scrollHeight+"px"}))})),window.atualizarAlturasAccordions=function(){document.querySelectorAll(".accordion-content").forEach((t=>{t.style.maxHeight&&(t.style.maxHeight=t.scrollHeight+"px")}))},elResCltPacote=document.getElementById("res-clt-pacote"),elResCltSalarioEmConta=document.getElementById("res-clt-salario-em-conta"),elResCltImpostos=document.getElementById("res-clt-impostos"),elResCltAliquota=document.getElementById("res-clt-aliquota"),elTaxDetailsClt=document.getElementById("tax-details-clt")})),window.addEventListener("load",(()=>{initAnimadores(),calcularEAtualizarUI()}))}function calcularEAtualizarUI(){try{const t={bruto:getFloat("clt-bruto"),dependentes:getFloat("clt-dependentes"),beneficios:getFloat("clt-beneficios"),descontos:getFloat("clt-descontos"),incluirProvisao:getChecked("clt-incluir-provisao"),plrAnual:getFloat("clt-plr-anual"),incluirFGTS:getChecked("clt-incluir-fgts")},e=t.bruto>0?calcularCLT_Colaborador(t):{valorFinal:0,totalImpostos:0,aliquotaEfetiva:0,detalhesImpostos:[],bruto:0,inss:0,irrf:0,salarioEmConta:0};ultimoResultadoCLT=e,atualizarResultados(e,t)}catch(t){console.error("Erro no cálculo:",t)}}function atualizarResultados(t,e){const o=t.valorFinal||0,a=t.salarioEmConta||0,l=t.totalImpostos||0;if(atualizarDonutCharts({salarioEmConta:t.salarioEmConta,beneficiosProvisoes:Math.max(0,t.valorFinal-t.salarioEmConta),impostosDescontos:t.totalImpostos}),document.querySelectorAll(".card").forEach((t=>{t.classList.remove("is-updating"),t.offsetWidth,t.classList.add("is-updating")})),animadores["res-clt-pacote"]?animadores["res-clt-pacote"].update(o):elResCltPacote&&(elResCltPacote.textContent=formatBRL(o)),animadores["res-clt-salario-em-conta"]?animadores["res-clt-salario-em-conta"].update(a):elResCltSalarioEmConta&&(elResCltSalarioEmConta.textContent=formatBRL(a)),elResCltImpostos&&(elResCltImpostos.textContent=formatBRL(l)),elResCltAliquota&&(elResCltAliquota.textContent=`${(100*t.aliquotaEfetiva).toFixed(1)}% do bruto`.replace(".",",")),elTaxDetailsClt){elTaxDetailsClt.textContent="";let e=0,o=0;const a=document.createDocumentFragment(),l=document.createDocumentFragment();if(t.detalhesImpostos.forEach((t=>{"provento"===t.tipo&&t.valor>0?(a.appendChild(criarTaxItem(t.nome,t.valor,t.percentual,"provento","do bruto")),e+=t.valor):"desconto"===t.tipo&&t.valor>0&&(l.appendChild(criarTaxItem(t.nome,t.valor,t.percentual,"desconto","do bruto")),o+=t.valor)})),e>0&&(a.appendChild(criarTaxItemTotal("Total de Benefícios",e,"provento")),elTaxDetailsClt.appendChild(a)),o>0&&(l.appendChild(criarTaxItemTotal("Total de Descontos",o,"desconto")),elTaxDetailsClt.appendChild(l)),0===elTaxDetailsClt.childElementCount){const t=document.createElement("div");t.className="tax-item";const e=document.createElement("span");e.textContent="Nenhum detalhe",t.appendChild(e),elTaxDetailsClt.appendChild(t)}}atualizarAlturasAccordions()}function calcularCLT_Colaborador(t){const{bruto:e,dependentes:o,beneficios:a,descontos:l,incluirProvisao:n,plrAnual:r,incluirFGTS:s}=t,i=l,c=calcularINSS_Progressivo(e),u=calcularIRRF_Preciso(e,c,o,i),d=c+u+i,m=e-d,p=(r||0)/12,C=m+a+p,f=n?calcularProvisaoLiquida13(e,o):0,h=n?calcularProvisaoLiquidaFerias(e,c,u,o,i):0,E=.08*e,v=C+(s?E:0)+(f+h),g=[];return a>0&&g.push({nome:"Benefícios (VR, VA, etc)",valor:a,percentual:a/(e||1),tipo:"provento"}),p>0&&g.push({nome:"PLR (Provisão Mensal)",valor:p,percentual:p/(e||1),tipo:"provento"}),s&&E>0&&g.push({nome:"FGTS (Depósito Mensal)",valor:E,percentual:E/(e||1),tipo:"provento"}),n&&f>0&&g.push({nome:"13º (Média Líquida)",valor:f,percentual:f/(e||1),tipo:"provento"}),n&&h>0&&g.push({nome:"Férias + 1/3 (Média Líquida)",valor:h,percentual:h/(e||1),tipo:"provento"}),c>0&&g.push({nome:"INSS",valor:c,percentual:c/(e||1),tipo:"desconto"}),u>0&&g.push({nome:"IRRF",valor:u,percentual:u/(e||1),tipo:"desconto"}),i>0&&g.push({nome:"Outros Descontos",valor:i,percentual:i/(e||1),tipo:"desconto"}),{valorFinal:v,salarioEmConta:m,totalImpostos:d,aliquotaEfetiva:e>0?d/e:0,detalhesImpostos:g,bruto:e,inss:c,irrf:u}}function calcularProvisaoLiquida13(t,e){if(t<=0)return 0;const o=calcularINSS_Progressivo(t);return(t-o-calcularIRRF_PelaTabela(t-o,e))/12}function calcularProvisaoLiquidaFerias(t,e,o,a,l){if(t<=0)return 0;const n=t+t/3,r=calcularINSS_Progressivo(n);return(n-r-calcularIRRF_Preciso(n,r,a,l)-l)/12}function criarOuAtualizarDonut(t,e,o,a,l){const n=document.getElementById(e);if(!n)return null;const r=[],s=[],i=[];a.forEach(((t,e)=>{t>0&&(r.push(t),s.push(o[e]),i.push(l[e]))})),0===r.length&&(r.push(1),s.push("Nenhum dado"),i.push("#3A3052"));const c={labels:s,datasets:[{data:r,backgroundColor:i,borderColor:"rgba(255,255,255,0)",borderWidth:0,hoverOffset:4}]},u={type:"doughnut",data:c,options:{responsive:!0,maintainAspectRatio:!0,cutout:"70%",plugins:{legend:{display:!0,position:"bottom",labels:{color:"#A09CB0",font:{family:"Poppins"},padding:10}},tooltip:{callbacks:{label:function(t){const e=t.label||"",o=t.raw||0,a=t.chart.data.datasets[0].data.reduce(((t,e)=>t+e),0),l=a>0?(o/a*100).toFixed(1):0;return"Nenhum dado"===e?"Nenhum dado":` ${e}: ${formatBRL(o)} (${l.replace(".",",")}%)`}}}}}};return t?(t.data=c,t.update(),t):new Chart(n,u)}function atualizarDonutCharts(t){cltDonutChart=criarOuAtualizarDonut(cltDonutChart,"clt-donut-chart",["Salário em Conta","Benefícios/Provisões","Impostos/Descontos"],[t.salarioEmConta,t.beneficiosProvisoes,t.impostosDescontos],["#1976D2","#F57C00","#D32F2F"])}